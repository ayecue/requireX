/**
 *	requireX - Load external images, stylesheets and javascript (AMD)
 *	--
 *
 *	@package			requireX
 *	@version 			0.8.2.7
 *	@author 			swe <soerenwehmeier@googlemail.com>
 *
 */
(function(e){"use strict";function q(){var e=j.argsHandler.require(arguments),t=new I(e.files,e.settings,e.process);return t.dfd.always(function(){!!j.master&&j.master.id==t.dfd.id&&(j.master=null);!!e.callback&&e.callback.apply(null,arguments);t.flush()})}function R(){return j.master=j.master?j.master.next.apply(j.master,arguments):q.apply(null,arguments)}function U(){if(j.loading){var e=j.argsHandler.define(arguments);if(e.create){var t;if(e.requires){var n=j.loading,r=new I(e.requires,N({root:n.path},e.settings));return n.toLoad=r.dfd.then(function(){t=e.create.apply(n,arguments);j.defined.set(n.path,t);h[n.path.stack.file]=t;r.flush()})}t=e.create.call(j.loading);j.defined.set(j.loading.path,t);h[j.loading.path.stack.file]=t}}}function z(e){return j.pending.is(new _(e))}function W(e){var t=new _(e);return j.cache.is(t)&&j.cache.get(t).success}function X(){var e=new B,t=j.argsHandler.waitForFiles(arguments),n=[],r=E(t,function(e,t){var r=new _(t);if(j.pending.is(r)){n.push(j.pending.get(r).dfd)}else if(!j.cache.is(r)){var i=new B,s=0,o=f(function(){if(++s>d){l(o)}else if(j.pending.is(r)){j.pending.get(r).dfd.then(function(){i.complete()});l(o)}else if(j.cache.is(r)){i.complete();l(o)}},10);n.push(i)}this.result.push(r)},[]),i=function(){e.complete.apply(e,E(r,function(e,t){if(!j.cache.is(t)||!j.cache.get(t).success){this.result[0]=false}this.result[1][e]=j.defined.get(t)||j.cache.get(t)},[true,[]]))};n.length?B.deferred.apply(null,n).always(i):a(i,0);return e}var t=["require","define","isLoaded","isPending","waitForFiles"],n=["forEach","toArray","unite","extend","getFirstOfType","getType","Class","Promise","author","version","modules"],r="swe",i="0.8.2.7",s=document,o=s.styleSheets,u=RegExp,a=setTimeout,f=setInterval,l=clearInterval,c=[].slice,h={},p=1e3,d=1e3,v=/^(https?:\/\/)?(?:(www)\.)?(.*)/i,m=/^([^\/?]+)\/?([^?]*)\??(.*)/i,g=/^([^?]*)\??(.*)/i,y=/(?:\/|^)(.*?)\/?([^\/]+?)(?:\.([^\.]*))?$/,b=/^.*\/?\.{1,2}\//i,w=["!(pull|[#\\-])([^;]*?);","g"],E=function(e,t,n){if(e==null){return null}var r,i={result:n,skip:false};if(typeof e=="function"){while((r=e.call(i))&&!i.skip){t.call(i,r)}}else if(r=e.length){for(var s=0;s<r&&!i.skip;t.call(i,s,e[s++]));}else{for(var s in e){typeof e[s]!="unknown"&&t.call(i,s,e[s]);if(i.skip){break}}}return i.result},S=c?function(e){return c.call(e)}:function(e){var t=[];push.apply(t,e);return t},x=function(e){return a(e,0)},T=function(e,t,n){!!n||(n=function(e){return e});return E(e,function(e,r){!!r&&(this.result[r]=t[n(e)])},{})},N=function(){var e=S(arguments),t=e.length-1,n=true,r=e.shift()||{};k(e[t])=="boolean"&&(n=e.pop());return E(e,function(e,t){k(t)=="object"&&(this.result=E(t,function(e,r){!!(n||r!=null&&r.length)&&t.hasOwnProperty(e)&&(this.result[e]=r)},this.result))},r)},C=function(t,n){return E(t,function(e,t){if(k(t)==n){this.result=e;this.skip=true}})},k=function(e){return!!j&&!!j.typeifier?j.typeifier.compile(e):typeof e},L=(new function(){var e=this;e.add=function(t,n){k(t)=="string"?e[t]=n:E(t,function(t,r){e[r]=n});return e}}).add("js","script").add("css","stylesheet").add(["jpg","jpeg","gif","png"],"image"),A=function(){return E(arguments,function(e,t){var n=t.create;if(n){var r=this.result.prototype.create;this.result.prototype.create=r?function(){return E([n.apply(this,arguments),r.apply(this,arguments)],function(e,t){t&&(t instanceof Array?this.result.concat(t):this.result.push(t))},[])}:function(){return n.apply(this,arguments)};t.create=null;delete t.create}if(t.static){N(this.result,t.static);t.static=null;delete t.static}N(this.result.prototype,t)},function(){return!!this.create?this.create.apply(this,arguments):this})},O=new A({create:function(e){this.handler=e},compile:function(e){var t=typeof e,n=this.handler[t];return n?n(e):t},flush:function(){this.handler=null}}),M=new A({create:function(e,t){var n=k(t)=="array",r=n?t[0]:t,i=n?t.slice(1):null;N(this,{stack:E((e||"").split(r),function(e,t){t.length&&this.result.push(!!i&&!!i.length?new M(t,i):t)},[]),delimiter:r,next:i})},get:function(){return E(this.stack,function(e,t){this.result.push(t instanceof M?t.get():t)},[]).join(this.delimiter)},unshift:function(e){this.stack.unshift(!!this.next?new M(e,this.next):e)},shift:function(){return this.stack.shift()},push:function(e){this.stack.push(!!this.next?new M(e,this.next):e)},pop:function(){return this.stack.pop()},concat:function(e){e instanceof M&&this.stack.concat(e.stack)},morph:function(e){e instanceof M&&(this.stack=e.stack.concat(this.stack))},flush:function(){this.stack=null}}),_=new A({"static":{types:L},create:function(e){var t=this,n=e.match(v).slice(1),r=N({ext:"js"},{protocol:n.shift(),prefix:n.shift()});n=n.shift().match(!!r.protocol||!!r.prefix?m:g).slice(1);N(r,{uri:new M(n.pop(),["&","="]),path:n.pop(),host:n.pop()});if(!!r.path&&r.path.length){n=r.path.match(y);N(r,{ext:n.pop(),file:n.pop(),dir:new M(n.pop(),["/"])})}N(t.stack=r,{fullext:r.ext?_.types[r.ext.toLowerCase()]:"script"})},src:function(){var e=this;return E([e.stack.protocol,!!e.stack.prefix&&e.stack.prefix+".",!!e.stack.host&&e.stack.host+"/",!!e.stack.dir&&!!e.stack.dir.stack.length&&e.stack.dir.get()+"/"],function(e,t){!!t&&(this.result+=t)},"")},directory:function(){var e=this;return E([!!e.stack.dir&&!!e.stack.dir.stack.length&&e.stack.dir.get()+"/",e.stack.file,!!e.stack.ext&&"."+e.stack.ext],function(e,t){!!t&&(this.result+=t)},"").replace(b,"")},file:function(){return E([this.stack.file,!!this.stack.ext&&"."+this.stack.ext],function(e,t){!!t&&(this.result+=t)},"")},uri:function(){return!!this.stack.uri&&!!this.stack.uri.stack.length&&"?"+this.stack.uri.get()},full:function(){return E([this.src(),this.file(),this.uri()],function(e,t){!!t&&(this.result+=t)},"")},type:function(){return this.stack.fullext},morph:function(e){e instanceof _&&this.stack.host==e.stack.host&&this.stack.dir.morph(e.stack.dir)},refresh:function(){this.stack.uri.push("_="+(new Date).getTime())},flush:function(){this.uri=null;this.dir=null}}),D=new A({"static":{filter:function(e){return"$"+(e+1)}},create:function(e){var t=RegExp.apply(new RegExp,w);N(this,{cleared:e.replace(RegExp.apply(new RegExp,w),""),collection:E(function(){return t.exec(e)},function(){var e=T(["operator","line"],RegExp,D.filter);(this.result[e.operator]||(this.result[e.operator]=[])).push(e.line)},{})})},eachCollection:function(t,n){if(t){return E(t,function(t,n){var r=n.split("."),i=r.shift(),s=e[i];if(!!s){if(!!r.length){N(this.result,E(function(){return r.shift()},function(e){!(this.result=this.result[e])&&(this.skip=true)},s))}else{this.result[i]=s;this.skip=true}}},{})}return null},getModuleVariables:function(){return this.eachCollection(this.collection["#"],function(e,t){var n={};n[e]=t;return n})},doAutoExecution:function(){return this.eachCollection(this.collection["-"],function(e,t){var n={};n[e]=k(t)=="function"?t.call(null):null;return n})},pullToGlobal:function(){if(!!this.collection.pull){N(e,h)}},flush:function(){this.collection=null}}),P=new A({"static":{"native":{set:function(e,t){this[e]=t},is:function(e){return!!this[e]},get:function(e){return this.instance.is(e)&&this[e]},clear:function(e){if(this.instance.is(e)){this.instance.set(e,null);delete this[e]}}}},create:function(e){var t=this;t.container={instance:t};e=N({},P.native,e);E(e,function(e,n){if(!t[e]){k(n)=="function"?t[e]=function(){return n.apply(t.container,arguments)}:t[e]=n}})},toRoot:function(){return N(this,{set:function(e,t){!this.container[e.type()]&&(this.container[e.type()]=new P);this.container[e.type()].set(e.directory(),t)},is:function(e){return!!this.container[e.type()]&&!!this.container[e.type()].is(e.directory())},get:function(e){return this.is(e)&&this.container[e.type()].get(e.directory())},clear:function(e){if(this.is(e)){this.set(e,null);delete this.container[e.type()]}}})},flush:function(){this.set=null;this.is=null;this.get=null;this.clear=null}}),H=new A({create:function(e){N(this,{type:e,stack:[]})},add:function(e){this.stack.push(e)},is:function(e){return this.type==null||e===this.type},run:function(e,t){this.is(e)&&E(function(){return this.result.stack[0]},function(){this.result.stack.shift().apply(null,t||[])},this)},flush:function(){this.stack=null}}),B=new A({"static":{deferred:function(){var e=new B,t=[],n=arguments,r=n.length,i=function(n,i){t[n]=i;if(t.length==r&&E(t,function(e,t){if(t==null){this.result=false;this.skip=true}},true)){e.complete(true,t);e.flush()}};E(n,function(e,t){t instanceof B&&t.always(function(){var t=arguments.length;i(e,!!t&&(t>1?arguments:arguments[0]))})});return e},queue:function(e,t){var n=0,r=function(){if(!e[n]){return false}e[n].always(function(){r(++n)});return t(n)};return r()&&B.deferred.apply(null,e)}},create:function(){var e=this,t=[new H(true),new H(false),new H];N(e,{states:t,id:Math.floor((new Date).getTime()*Math.random()),then:function(n){t[0].add(n);return e},fail:function(n){t[1].add(n);return e},always:function(n){t[2].add(n);return e}})},complete:function(e,t){E(this.states,function(n,r){r.run(e,t)})},next:function(){var e=new B,t=arguments;this.always(function(){q.apply(null,t).then(function(){e.complete(true,arguments)}).fail(function(){e.complete(false,arguments)})});return e},flush:function(){this.states=null;this.then=null;this.fail=null;this.always=null}}),j=new A({"static":{argsHandler:new A({"static":{define:function(e){return E({settings:"object",requires:"array",create:"function"},function(t,n){var r=C(e,n);if(r!=null){this.result[t]=e[r];e[r]=null;delete e[r]}},{})},waitForFiles:function(e){return k(e[0])=="array"?e[0]:e},require:function(e){return E({files:"array",settings:"object",callback:"function",process:"function"},function(t,n){var r=C(e,n);if(r!=null){this.result[t]=e[r];e[r]=null;delete e[r]}},{})}}}),typeifier:new O({object:function(t){var n=t.length;return function(n){return E(t,function(t,r){if(n instanceof e[r]){this.result=r.toLowerCase();this.skip=true}})||"object"}}(["Array","Number","Date","RegExp"])}),browser:function(){var e={},t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i),r;if(n||(r=t.match(/version\/([\.\d]+)/i))){e[n[1]]=true;e.version=r?r[1]:n[2];return e}e[navigator.appName]=true;e.version=navigator.appVersion;return e}(),appendTo:function(e){return e.length?e[0]:null}(s.getElementsByTagName("head")),cache:(new P).toRoot(),pending:(new P).toRoot(),defined:(new P).toRoot(),loading:null,load:new A({"static":{script:function(e){var t=new B,n=document.createElement("script"),r=function(r,i){if(!n)return;var s=n.readyState;if(i||!s||/loaded|complete/i.test(s)){n.onerror=n.onload=n.onreadystatechange=null;!!n.parentNode&&n.parentNode.removeChild(n);j.loading=n=null;t.complete(e.success=!i);t.flush()}},i=function(e){r(e,true)};j.loading=e;x(function(){N(n,{type:"text/javascript",charset:"utf-8",async:true,onload:r,onreadystatechange:r,onerror:i,src:e.path.full()},e.settings,false);j.appendTo.appendChild(n)});return t},stylesheet:function(e){var t=new B,n=document.createElement("link"),r=function(r,i){if(!n)return;var s=n.readyState;if(i||!s||/loaded|complete/i.test(s)){l(o);n.onload=n.onreadystatechange=null;!!i&&!!n.parentNode&&n.parentNode.removeChild(n);j.loading=n=null;t.complete(e.success=!i);t.flush()}},i=function(e){r(e,true)},s=0,o=f(function(){if(s>p)return i();try{!!n.sheet.cssRules&&r()}catch(e){s++}},10);j.loading=e;x(function(){N(n,{type:"text/css",rel:"stylesheet",charset:"utf-8",onload:r,onreadystatechange:r,onerror:i,href:e.path.full()},e.settings,false);j.appendTo.appendChild(n)});return t},image:function(e){var t=new B,n=new Image,r=function(r,i){if(!n)return;var s=n.readyState;if(i||!s||/loaded|complete/i.test(s)){n.onload=n.onerror=n.onabort=null;j.loading=n=null;t.complete(e.success=!i);t.flush()}},i=function(e){r(e,true)};j.loading=e;x(function(){N(n,{onload:r,onreadystatechange:r,onerror:i,onabort:i,src:e.path.full()},e.settings,false)});return t}},create:function(e){var t=new B;x(function(){if(!j.load[e.path.type()]){return t.complete(e.success=false,[e])}j.load[e.path.type()](e).always(function(){if(!!e.toLoad){e.toLoad.always(function(){e.variables=e.exec.getModuleVariables();e.autoexecution=e.exec.doAutoExecution();e.exec.pullToGlobal();e.toLoad=null;delete e.toLoad;t.complete(null,[e]);t.flush()})}else{e.variables=e.exec.getModuleVariables();e.autoexecution=e.exec.doAutoExecution();e.exec.pullToGlobal();t.complete(null,[e]);t.flush()}})});return t}})}}),F=new A({create:function(e,t){var n=this,r=new D(e);N(n,{dfd:new B,exec:r,path:new _(r.cleared),settings:t});j.pending.set(n.path,n);if(!!t){!!t.refresh&&n.path.refresh();!!t.root&&n.path.morph(t.root)}},run:function(){var e=this,t=j.cache.get(e.path);if(!t||!t.success){return(new j.load(e)).always(function(e){j.pending.clear(e.path);j.cache.set(e.path,e);e.dfd.complete(e.success,[e])})}x(function(){e.dfd.complete(true,[t])})},flush:function(){this.dfd=null;this.exec=null;this.path=null;this.settings=null}}),I=new A({create:function(e,t,n){var r=[],i=this;N(i,{stack:E(e,function(e,n){if(!n){return}var i=new F(n,t);this.result.push(i);r.push(i.dfd)},[]),dfd:new B});B.queue(r,function(e){!!n&&n.call(i.stack[e],e,i.stack[e].path);i.stack[e].run();return true}).always(function(){i.dfd.complete.apply(i.dfd,E(arguments,function(e,t){!t.success&&(this.result[0]=false);this.result[1].push(j.defined.get(t.path)||t)},[true,[]]))})},flush:function(){this.stack=null;this.dfd=null}});N(e,T(t,[R,U,z,W,X]));N(e[t[0]],T(n,[E,S,T,N,C,k,A,B,r,i,h]))})(this.window||this)
