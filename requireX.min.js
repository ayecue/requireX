/**
 *	requireX - Load external images, stylesheets and javascript (AMD)
 *
 *	@package			requireX
 *	@version 			0.8.2.0
 *	@author 			swe <soerenwehmeier@googlemail.com>
 *
 */
(function(e){"use strict";function I(){var e=B.argsHandler.require(arguments),t=new F(e.files,e.settings,e.process);return t.dfd.always(function(){!!B.master&&B.master.id==t.dfd.id&&(B.master=null);!!e.callback&&e.callback.apply(null,arguments)})}function q(){return B.master=B.master?B.master.next.apply(B.master,arguments):I.apply(null,arguments)}function R(){if(B.loading){var e=B.argsHandler.define(arguments);if(e.create){if(e.requires){var t=B.loading,n=new F(e.requires,T({root:t.path},e.settings));return t.toLoad=n.dfd.then(function(){B.defined.set(t.path,e.create.apply(t,arguments))})}B.defined.set(B.loading.path,e.create.call(B.loading))}}}function U(e){return B.pending.is(new M(e))}function z(e){var t=new M(e);return B.cache.is(t)&&B.cache.get(t).success}function W(){var e=new H,t=B.argsHandler.waitForFiles(arguments),n=[],r=w(t,function(e,t){var r=new M(t);if(B.pending.is(r)){n.push(B.pending.get(r).dfd)}else if(!B.cache.is(r)){var i=new H,s=0,o=f(function(){if(++s>p){l(o)}else if(B.pending.is(r)){B.pending.get(r).dfd.then(function(){i.complete()});l(o)}else if(B.cache.is(r)){i.complete();l(o)}},10);n.push(i)}this.result.push(r)},[]),i=function(){e.complete.apply(e,w(r,function(e,t){if(!B.cache.is(t)||!B.cache.get(t).success){this.result[0]=false}this.result[1][e]=B.defined.get(t)||B.cache.get(t)},[true,[]]))};n.length?H.deferred.apply(null,n).always(i):a(i,0);return e}var t=["require","define","isLoaded","isPending","waitForFiles"],n=["forEach","toArray","unite","extend","getFirstOfType","getType","Class","author","version"],r="swe",i="0.8.2.0",s=document,o=s.styleSheets,u=RegExp,a=setTimeout,f=setInterval,l=clearInterval,c=[].slice,h=1e3,p=1e3,d=/^(https?:\/\/)?(?:(www)\.)?(.*)/i,v=/^([^\/?]+)\/?([^?]*)\??(.*)/i,m=/^([^?]*)\??(.*)/i,g=/(?:\/|^)(.*?)\/?([^\/]+?)(?:\.([^\.]*))?$/,y=/^.*\/?\.{1,2}\//i,b=["!([#\\-])([^;]+?);","g"],w=function(e,t,n){if(e==null){return null}var r,i={result:n,skip:false};if(typeof e=="function"){while((r=e.call(i))&&!i.skip){t.call(i,r)}}else if(r=e.length){for(var s=0;s<r&&!i.skip;t.call(i,s,e[s++]));}else{for(var s in e){t.call(i,s,e[s]);if(i.skip){break}}}return i.result},E=c?function(e){return c.call(e)}:function(e){return w(e,function(e,t){this.result.unshift(t)},[])},S=function(e){return a(e,0)},x=function(e,t,n){!!n||(n=function(e){return e});return w(e,function(e,r){!!r&&(this.result[r]=t[n(e)])},{})},T=function(){var e=E(arguments),t=e.length-1,n=true,r=e.shift()||{};C(e[t])=="boolean"&&(n=e.pop());return w(e,function(e,t){C(t)=="object"&&(this.result=w(t,function(e,t){!!(n||t!=null&&t.length)&&(this.result[e]=t)},this.result))},r)},N=function(t,n){return w(t,function(e,t){if(C(t)==n){this.result=e;this.skip=true}})},C=function(e){return!!B&&!!B.typeifier?B.typeifier.compile(e):typeof e},k=(new function(){var e=this;e.add=function(t,n){C(t)=="string"?e[t]=n:w(t,function(t,r){e[r]=n});return e}}).add("js","script").add("css","stylesheet").add(["jpg","jpeg","gif","png"],"image"),L=function(){return w(arguments,function(e,t){var n=t.create;if(n){var r=this.result.prototype.create;this.result.prototype.create=r?function(){return w([n.apply(this,arguments),r.apply(this,arguments)],function(e,t){t&&(t instanceof Array?this.result.concat(t):this.result.push(t))},[])}:function(){return n.apply(this,arguments)};delete t.create}if(t.static){T(this.result,t.static);delete t.static}T(this.result.prototype,t)},function(){return!!this.create?this.create.apply(this,arguments):this})},A=new L({create:function(e){this.handler=e},compile:function(e){var t=typeof e,n=this.handler[t];return n?n(e):t}}),O=new L({create:function(e,t){var n=C(t)=="array",r=n?t[0]:t,i=n?t.slice(1):null;T(this,{stack:w((e||"").split(r),function(e,t){t.length&&this.result.push(!!i&&!!i.length?new O(t,i):t)},[]),delimiter:r,next:i})},get:function(){return w(this.stack,function(e,t){this.result.push(t instanceof O?t.get():t)},[]).join(this.delimiter)},unshift:function(e){this.stack.unshift(!!this.next?new O(e,this.next):e)},shift:function(){return this.stack.shift()},push:function(e){this.stack.push(!!this.next?new O(e,this.next):e)},pop:function(){return this.stack.pop()},concat:function(e){e instanceof O&&this.stack.concat(e.stack)},morph:function(e){e instanceof O&&(this.stack=e.stack.concat(this.stack))}}),M=new L({"static":{types:k},create:function(e){var t=this,n=e.match(d).slice(1),r=T({ext:"js"},{protocol:n.shift(),prefix:n.shift()});n=n.shift().match(!!r.protocol||!!r.prefix?v:m).slice(1);T(r,{uri:new O(n.pop(),["&","="]),path:n.pop(),host:n.pop()});if(!!r.path&&r.path.length){n=r.path.match(g);T(r,{ext:n.pop(),file:n.pop(),dir:new O(n.pop(),["/"])})}T(t.stack=r,{fullext:r.ext?M.types[r.ext.toLowerCase()]:"script"})},src:function(){var e=this;return w([e.stack.protocol,!!e.stack.prefix&&e.stack.prefix+".",!!e.stack.host&&e.stack.host+"/",!!e.stack.dir&&!!e.stack.dir.stack.length&&e.stack.dir.get()+"/"],function(e,t){!!t&&(this.result+=t)},"")},directory:function(){var e=this;return w([!!e.stack.dir&&!!e.stack.dir.stack.length&&e.stack.dir.get()+"/",e.stack.file,!!e.stack.ext&&"."+e.stack.ext],function(e,t){!!t&&(this.result+=t)},"").replace(y,"")},file:function(){return w([this.stack.file,!!this.stack.ext&&"."+this.stack.ext],function(e,t){!!t&&(this.result+=t)},"")},uri:function(){return!!this.stack.uri&&!!this.stack.uri.stack.length&&"?"+this.stack.uri.get()},full:function(){return w([this.src(),this.file(),this.uri()],function(e,t){!!t&&(this.result+=t)},"")},type:function(){return this.stack.fullext},morph:function(e){e instanceof M&&this.stack.host==e.stack.host&&this.stack.dir.morph(e.stack.dir)},refresh:function(){this.stack.uri.push("_="+(new Date).getTime())}}),_=new L({"static":{filter:function(e){return"$"+(e+1)}},create:function(e){var t=RegExp.apply(new RegExp,b);T(this,{cleared:e.replace(RegExp.apply(new RegExp,b),""),collection:w(function(){return t.exec(e)},function(){var e=x(["operator","line"],RegExp,_.filter);(this.result[e.operator]||(this.result[e.operator]=[])).push(e.line)},{})})},eachCollection:function(t,n){if(t){return w(t,function(t,n){var r=n.split("."),i=r.shift(),s=e[i];if(!!s){if(!!r.length){T(this.result,w(function(){return r.shift()},function(e){!(this.result=this.result[e])&&(this.skip=true)},s))}else{this.result[i]=s;this.skip=true}}},{})}return null},getModuleVariables:function(){return this.eachCollection(this.collection["#"],function(e,t){var n={};n[e]=t;return n})},doAutoExecution:function(){return this.eachCollection(this.collection["-"],function(e,t){var n={};n[e]=C(t)=="function"?t.call(null):null;return n})}}),D=new L({"static":{"native":{set:function(e,t){this[e]=t},is:function(e){return!!this[e]},get:function(e){return this.instance.is(e)&&this[e]},clear:function(e){if(this.instance.is(e)){this.instance.set(e,null);delete this[e]}}}},create:function(e){var t=this;t.container={instance:t};e=T({},D.native,e);w(e,function(e,n){if(!t[e]){C(n)=="function"?t[e]=function(){return n.apply(t.container,arguments)}:t[e]=n}})},toRoot:function(){return T(this,{set:function(e,t){!this.container[e.type()]&&(this.container[e.type()]=new D);this.container[e.type()].set(e.directory(),t)},is:function(e){return!!this.container[e.type()]&&!!this.container[e.type()].is(e.directory())},get:function(e){return this.is(e)&&this.container[e.type()].get(e.directory())},clear:function(e){if(this.is(e)){this.set(e,null);delete this.container[e.type()]}}})}}),P=new L({create:function(e){T(this,{type:e,stack:[]})},add:function(e){this.stack.push(e)},is:function(e){return this.type==null||e===this.type},run:function(e,t){this.is(e)&&w(function(){return this.result.stack[0]},function(){this.result.stack.shift().apply(null,t||[])},this)}}),H=new L({"static":{deferred:function(){var e=new H,t=[],n=arguments,r=n.length,i=function(n,i){t[n]=i;t.length==r&&w(t,function(e,t){if(t==null){this.result=false;this.skip=true}},true)&&e.complete(true,t)};w(n,function(e,t){t instanceof H&&t.always(function(){var t=arguments.length;i(e,!!t&&(t>1?arguments:arguments[0]))})});return e},queue:function(e,t){var n=0,r=function(){if(!e[n]){return false}e[n].always(function(){r(++n)});return t(n)};return r()&&H.deferred.apply(null,e)}},create:function(){var e=this,t=[new P(true),new P(false),new P];T(e,{states:t,id:Math.floor((new Date).getTime()*Math.random()),then:function(n){t[0].add(n);return e},fail:function(n){t[1].add(n);return e},always:function(n){t[2].add(n);return e}})},complete:function(e,t){w(this.states,function(n,r){r.run(e,t)})},next:function(){var e=new H,t=arguments;this.always(function(){I.apply(null,t).then(function(){e.complete(true,arguments)}).fail(function(){e.complete(false,arguments)})});return e}}),B=new L({"static":{argsHandler:new L({"static":{define:function(e){return w({settings:"object",requires:"array",create:"function"},function(t,n){var r=N(e,n);if(r!=null){this.result[t]=e[r];e[r]=null;delete e[r]}},{})},waitForFiles:function(e){return C(e[0])=="array"?e[0]:e},require:function(e){return w({files:"array",settings:"object",callback:"function",process:"function"},function(t,n){var r=N(e,n);if(r!=null){this.result[t]=e[r];e[r]=null;delete e[r]}},{})}}}),typeifier:new A({object:function(t){var n=t.length;return function(n){return w(t,function(t,r){if(n instanceof e[r]){this.result=r.toLowerCase();this.skip=true}})||"object"}}(["Array","Number","Date","RegExp"])}),browser:function(){var e={},t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i),r;if(n||(r=t.match(/version\/([\.\d]+)/i))){e[n[1]]=true;e.version=r?r[1]:n[2];return e}e[navigator.appName]=true;e.version=navigator.appVersion;return e}(),appendTo:function(e){return e.length?e[0]:null}(s.getElementsByTagName("head")),cache:(new D).toRoot(),pending:(new D).toRoot(),defined:(new D).toRoot(),loading:null,load:new L({"static":{script:function(e){var t=new H,n=document.createElement("script"),r=function(r,i){if(!n)return;var s=n.readyState;if(i||!s||/loaded|complete/i.test(s)){n.onerror=n.onload=n.onreadystatechange=null;!!n.parentNode&&n.parentNode.removeChild(n);B.loading=n=null;t.complete(e.success=!i&&!(B.browser.MSIE&&/loaded/.test(s)))}},i=function(e){r(e,true)};B.loading=e;S(function(){T(n,{type:"text/javascript",charset:"utf-8",async:true,onload:r,onreadystatechange:r,onerror:i,src:e.path.full()},e.settings,false);B.appendTo.appendChild(n)});return t},stylesheet:function(e){var t=new H,n=document.createElement("link"),r=function(r,i){if(!n)return;var s=n.readyState;if(i||!s||/loaded|complete/i.test(s)){l(o);n.onload=n.onreadystatechange=null;!!i&&!!n.parentNode&&n.parentNode.removeChild(n);B.loading=n=null;t.complete(e.success=!i)}},i=function(e){r(e,true)},s=0,o=f(function(){if(s>h)return i();try{!!n.sheet.cssRules&&r()}catch(e){s++}},10);B.loading=e;S(function(){T(n,{type:"text/css",rel:"stylesheet",charset:"utf-8",onload:r,onreadystatechange:r,onerror:i,href:e.path.full()},e.settings,false);B.appendTo.appendChild(n)});return t},image:function(e){var t=new H,n=new Image,r=function(r,i){if(!n)return;var s=n.readyState;if(i||!s||/loaded|complete/i.test(s)){n.onload=n.onerror=n.onabort=null;B.loading=n=null;t.complete(e.success=!i&&!(B.browser.MSIE&&/loaded/.test(s)))}},i=function(e){r(e,true)};B.loading=e;S(function(){T(n,{onload:r,onreadystatechange:r,onerror:i,onabort:i,src:e.path.full()},e.settings,false)});return t}},create:function(e){var t=new H;S(function(){if(!B.load[e.path.type()]){return t.complete(e.success=false,[e])}B.load[e.path.type()](e).then(function(){e.variables=e.exec.getModuleVariables();e.autoexecution=e.exec.doAutoExecution()}).always(function(){!!e.toLoad?e.toLoad.always(function(){e.toLoad=null;delete e.toLoad;t.complete(null,[e])}):t.complete(null,[e])})});return t}})}}),j=new L({create:function(e,t){var n=this,r=new _(e);T(n,{dfd:new H,exec:r,path:new M(r.cleared),settings:t});B.pending.set(n.path,n);if(!!t){!!t.refresh&&n.path.refresh();!!t.root&&n.path.morph(t.root)}},run:function(){var e=this,t=B.cache.get(e.path);if(!t||!t.success){return(new B.load(e)).always(function(e){B.pending.clear(e.path);B.cache.set(e.path,e);e.dfd.complete(e.success,[e])})}S(function(){e.dfd.complete(true,[t])})}}),F=new L({create:function(e,t,n){var r=[],i=this;T(i,{stack:w(e,function(e,n){if(!n){return}var i=new j(n,t);this.result.push(i);r.push(i.dfd)},[]),dfd:new H});H.queue(r,function(e){!!n&&n.call(i.stack[e],e,i.stack[e].path);i.stack[e].run();return true}).always(function(){i.dfd.complete.apply(i.dfd,w(arguments,function(e,t){!t.success&&(this.result[0]=false);this.result[1].push(B.defined.get(t.path)||t)},[true,[]]))})}});T(e,x(t,[q,R,U,z,W]));T(e[t[0]],x(n,[w,E,x,T,N,C,L,r,i]))})(this.window||this)