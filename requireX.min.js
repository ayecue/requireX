/**
 *	requireX - Load external images, stylesheets and javascript (AMD)
 *
 *	@package			requireX
 *	@version 			0.8.0.0
 *	@author 			swe <soerenwehmeier@googlemail.com>
 *
 */
(function(e){"use strict";function j(){var e=P.argsHandler.require(arguments),t=new B(e.files,e.settings,e.process);return t.dfd.always(function(){!!P.master&&P.master.id==t.dfd.id&&(P.master=null);!!e.callback&&e.callback.apply(null,arguments)})}function F(){return P.master=P.master?P.master.next.apply(P.master,arguments):j.apply(null,arguments)}function I(){if(P.loading){var e=P.argsHandler.define(arguments);if(e.create){if(e.requires){var t=P.loading,n=new B(e.requires,S({root:t.path},e.settings));return t.toLoad=n.dfd.then(function(){P.defined.set(t.path,e.create.apply(t,arguments))})}P.defined.set(P.loading.path,e.create.call(P.loading))}}}function q(e){return P.pending.is(new A(e))}function R(e){var t=new A(e);return P.cache.is(t)&&P.cache.get(t).success}function U(){var e=new D,t=P.argsHandler.waitForFiles(arguments),n=[],r=y(t,function(e,t){var r=new A(t);if(P.pending.is(r)){n.push(P.pending.get(r).dfd)}else if(!P.cache.is(r)){var i=new D,s=0,o=a(function(){if(++s>h){f(o)}else if(P.pending.is(r)){P.pending.get(r).dfd.then(function(){i.complete()});f(o)}else if(P.cache.is(r)){i.complete();f(o)}},10);n.push(i)}this.result.push(r)},[]),i=function(){e.complete.apply(e,y(r,function(e,t){if(!P.cache.is(t)||!P.cache.get(t).success){this.result[0]=false}this.result[1][e]=P.defined.get(t)||P.cache.get(t)},[true,[]]))};n.length?D.deferred.apply(null,n).always(i):u(i,0);return e}var t=["require","define","isLoaded","isPending","waitForFiles"],n="swe",r="1.0.0.0",i=document,s=i.styleSheets,o=RegExp,u=setTimeout,a=setInterval,f=clearInterval,l=[].slice,c=1e3,h=1e3,p=/^(https?:\/\/)?(?:(www)\.)?(.*)/i,d=/^([^\/?]+)\/?([^?]*)\??(.*)/i,v=/^([^?]*)\??(.*)/i,m=/(?:\/|^)(.*?)\/?([^\/]+?)(?:\.([^\.]*))?$/,g=["!([#\\-])([^;]+?);","g"],y=function(e,t,n){if(e==null){return null}var r,i={result:n,skip:false};if(typeof e=="function"){while((r=e.call(i))&&!i.skip){t.call(i,r)}}else if(r=e.length){for(var s=0;s<r&&!i.skip;t.call(i,s,e[s++]));}else{for(var s in e){t.call(i,s,e[s]);if(i.skip){break}}}return i.result},b=l?function(e){return l.call(e)}:function(e){return y(e,function(e,t){this.result.unshift(t)},[])},w=function(e){return u(e,0)},E=function(e,t,n){!!n||(n=function(e){return e});return y(e,function(e,r){!!r&&(this.result[r]=t[n(e)])},{})},S=function(){var e=b(arguments),t=e.length-1,n=true,r=e.shift()||{};T(e[t])=="boolean"&&(n=e.pop());return y(e,function(e,t){T(t)=="object"&&(this.result=y(t,function(e,t){!!(n||t!=null&&t.length)&&(this.result[e]=t)},this.result))},r)},x=function(t,n){return y(t,function(e,t){if(T(t)==n){this.result=e;this.skip=true}})},T=function(e){return!!P&&!!P.typeifier?P.typeifier.compile(e):typeof e},N=(new function(){var e=this;e.add=function(t,n){T(t)=="string"?e[t]=n:y(t,function(t,r){e[r]=n});return e}}).add("js","script").add("css","stylesheet").add(["jpg","jpeg","gif","png"],"image"),C=function(){return y(arguments,function(e,t){var n=t.create;if(n){var r=this.result.prototype.create;this.result.prototype.create=r?function(){return y([n.apply(this,arguments),r.apply(this,arguments)],function(e,t){t&&(t instanceof Array?this.result.concat(t):this.result.push(t))},[])}:function(){return n.apply(this,arguments)};delete t.create}if(t.static){S(this.result,t.static);delete t.static}S(this.result.prototype,t)},function(){return!!this.create?this.create.apply(this,arguments):this})},k=new C({create:function(e){this.handler=e},compile:function(e){var t=typeof e,n=this.handler[t];return n?n(e):t}}),L=new C({create:function(e,t){var n=T(t)=="array",r=n?t[0]:t,i=n?t.slice(1):null;S(this,{stack:y((e||"").split(r),function(e,t){t.length&&this.result.push(!!i&&!!i.length?new L(t,i):t)},[]),delimiter:r,next:i})},get:function(){return y(this.stack,function(e,t){this.result.push(t instanceof L?t.get():t)},[]).join(this.delimiter)},unshift:function(e){this.stack.unshift(!!this.next?new L(e,this.next):e)},push:function(e){this.stack.push(!!this.next?new L(e,this.next):e)},concat:function(e){e instanceof L&&this.stack.concat(e.stack)},morph:function(e){e instanceof L&&(this.stack=e.stack.concat(this.stack))}}),A=new C({"static":{types:N},create:function(e){var t=this,n=e.match(p).slice(1),r=S({ext:"js"},{protocol:n.shift(),prefix:n.shift()});n=n.shift().match(!!r.http||!!r.prefix?d:v).slice(1);S(r,{uri:new L(n.pop(),["&","="]),path:n.pop(),host:n.pop()});if(!!r.path&&r.path.length){n=r.path.match(m);S(r,{ext:n.pop(),file:n.pop(),dir:new L(n.pop(),["/"])})}S(t.stack=r,{fullext:r.ext?A.types[r.ext.toLowerCase()]:"script"})},src:function(){var e=this;return y([e.stack.protocol,!!e.stack.prefix&&e.stack.prefix+".",!!e.stack.host&&e.stack.host+"/",!!e.stack.dir&&!!e.stack.dir.stack.length&&e.stack.dir.get()+"/"],function(e,t){!!t&&(this.result+=t)},"")},file:function(){return y([this.stack.file,!!this.stack.ext&&"."+this.stack.ext],function(e,t){!!t&&(this.result+=t)},"")},uri:function(){return!!this.stack.uri&&!!this.stack.uri.stack.length&&"?"+this.stack.uri.get()},full:function(){return y([this.src(),this.file(),this.uri()],function(e,t){!!t&&(this.result+=t)},"")},type:function(){return this.stack.fullext},morph:function(e){e instanceof A&&this.host==e.host&&this.stack.dir.morph(e.stack.dir)},refresh:function(){this.stack.uri.push("_="+(new Date).getTime())}}),O=new C({"static":{filter:function(e){return"$"+(e+1)}},create:function(e){var t=RegExp.apply(new RegExp,g);S(this,{cleared:e.replace(t,""),collection:y(function(){return t.exec(e)},function(){var e=E(["operator","line"],RegExp,O.filter);(this.result[e.operator]||(this.result[e.operator]=[])).push(e.line)},{})})},eachCollection:function(t,n){if(t){return y(t,function(t,n){var r=n.split("."),i=e[r.shift()];!!i&&S(this.result,y(function(){return r.shift()},function(e){!(this.result=this.result[e])&&(this.skip=true)},i))},{})}return null},getModuleVariables:function(){return this.eachCollection(this.collection["#"],function(e,t){var n={};n[e]=t;return n})},doAutoExecution:function(){return this.eachCollection(this.collection["-"],function(e,t){var n={};n[e]=T(t)=="function"?t.call(null):null;return n})}}),M=new C({"static":{"native":{set:function(e,t){this[e]=t},is:function(e){return!!this[e]},get:function(e){return this.instance.is(e)&&this[e]},clear:function(e){if(this.instance.is(e)){this.instance.set(e,null);delete this[e]}}}},create:function(e){var t=this;t.container={instance:t};e=S({},M.native,e);y(e,function(e,n){if(!t[e]){T(n)=="function"?t[e]=function(){return n.apply(t.container,arguments)}:t[e]=n}})},toRoot:function(){return S(this,{set:function(e,t){!this.container[e.type()]&&(this.container[e.type()]=new M);this.container[e.type()].set(e.file(),t)},is:function(e){return!!this.container[e.type()]&&!!this.container[e.type()].is(e.file())},get:function(e){return this.is(e)&&this.container[e.type()].get(e.file())},clear:function(e){if(this.is(e)){this.set(e,null);delete this.container[e.type()]}}})}}),_=new C({create:function(e){S(this,{type:e,stack:[]})},add:function(e){this.stack.push(e)},is:function(e){return this.type==null||e===this.type},run:function(e,t){this.is(e)&&y(function(){return this.result.stack[0]},function(){this.result.stack.shift().apply(null,t)},this)}}),D=new C({"static":{deferred:function(){var e=new D,t=[],n=arguments,r=n.length,i=function(n,i){t[n]=i;t.length==r&&y(t,function(e,t){if(t==null){this.result=false;this.skip=true}},true)&&e.complete(true,t)};y(n,function(e,t){t instanceof D&&t.always(function(){var t=arguments.length;i(e,!!t&&(t>1?arguments:arguments[0]))})});return e},queue:function(e,t){var n=0,r=function(){if(!e[n]){return false}e[n].always(function(){r(++n)});return t(n)};return r()&&D.deferred.apply(null,e)}},create:function(){var e=this,t=[new _(true),new _(false),new _];S(e,{states:t,id:(new Date).getTime()*Math.random(),then:function(n){t[0].add(n);return e},fail:function(n){t[1].add(n);return e},always:function(n){t[2].add(n);return e}})},complete:function(e,t){y(this.states,function(n,r){r.run(e,t)})},next:function(){var e=new D,t=arguments;this.always(function(){j.apply(null,t).then(function(){e.complete(true,arguments)}).fail(function(){e.complete(false,arguments)})});return e}}),P=new C({"static":{argsHandler:new C({"static":{define:function(e){return y({settings:"object",requires:"array",create:"function"},function(t,n){var r=x(e,n);if(r!=null){this.result[t]=e[r];e[r]=null;delete e[r]}},{})},waitForFiles:function(e){return T(e[0])=="array"?e[0]:e},require:function(e){return y({files:"array",settings:"object",callback:"function",process:"function"},function(t,n){var r=x(e,n);if(r!=null){this.result[t]=e[r];e[r]=null;delete e[r]}},{})}}}),typeifier:new k({object:function(t){var n=t.length;return function(n){return y(t,function(t,r){if(n instanceof e[r]){this.result=r.toLowerCase();this.skip=true}})||"object"}}(["Array","Number","Date","RegExp"])}),browser:function(){var e={},t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i),r;if(n||(r=t.match(/version\/([\.\d]+)/i))){e[n[1]]=true;e.version=r?r[1]:n[2];return e}e[navigator.appName]=true;e.version=navigator.appVersion;return e}(),appendTo:function(e){return e.length?e[0]:null}(i.getElementsByTagName("head")),cache:(new M).toRoot(),pending:(new M).toRoot(),defined:(new M).toRoot(),loading:null,load:new C({"static":{script:function(e){var t=new D,n=document.createElement("script"),r=function(r,i){if(!n)return;var s=n.readyState;if(i||!s||/loaded|complete/i.test(s)){n.onerror=n.onload=n.onreadystatechange=null;!!n.parentNode&&n.parentNode.removeChild(n);P.loading=n=null;t.complete(e.success=!i&&!(P.browser.MSIE&&/loaded/.test(s)))}},i=function(e){r(e,true)};S(n,{type:"text/javascript",charset:"utf-8",async:true,onload:r,onreadystatechange:r,onerror:i,src:e.path.full()},e.settings,false);P.loading=e;P.appendTo.appendChild(n);return t},stylesheet:function(e){var t=new D,n=document.createElement("link"),r=function(r,i){if(!n)return;var s=n.readyState;if(i||!s||/loaded|complete/i.test(s)){f(o);n.onload=n.onreadystatechange=null;!i&&(i=!!(P.browser.MSIE&&/loaded/.test(s)));!!i&&!!n.parentNode&&n.parentNode.removeChild(n);P.loading=n=null;t.complete(e.success=!i)}},i=function(e){r(e,true)},s=0,o=a(function(){if(s>c)return i();try{!!n.sheet.cssRules&&r()}catch(e){s++}},10);S(n,{type:"text/css",rel:"stylesheet",charset:"utf-8",onload:r,onreadystatechange:r,onerror:i,href:e.path.full()},e.settings,false);P.loading=e;P.appendTo.appendChild(n);return t},image:function(e){var t=new D,n=new Image,r=function(r,i){if(!n)return;var s=n.readyState;if(i||!s||/loaded|complete/i.test(s)){n.onload=n.onerror=n.onabort=null;P.loading=n=null;t.complete(e.success=!i&&!(P.browser.MSIE&&/loaded/.test(s)))}},i=function(e){r(e,true)};P.loading=e;S(n,{onload:r,onreadystatechange:r,onerror:i,onabort:i,src:e.path.full()},e.settings,false);return t}},create:function(e){var t=new D;w(function(){if(!P.load[e.path.type()]){return t.complete(e.success=false,[e])}P.load[e.path.type()](e).then(function(){e.variables=e.exec.getModuleVariables();e.autoexecution=e.exec.doAutoExecution()}).always(function(){!!e.toLoad?e.toLoad.always(function(){t.complete(null,[e])}):t.complete(null,[e])})});return t}})}}),H=new C({create:function(e,t){var n=this,r=new O(e);S(n,{dfd:new D,exec:r,path:new A(r.cleared),settings:t});P.pending.set(n.path,n);if(!!t){!!t.refresh&&n.path.refresh();!!t.root&&n.path.morph(t.root)}},run:function(){var e=P.cache.get(this.path);if(!e||!e.success){return(new P.load(this)).always(function(e){P.pending.clear(e.path);P.cache.set(e.path,e);e.dfd.complete(e.success,[e])})}this.dfd.complete(true,[e])}}),B=new C({create:function(e,t,n){var r=[],i=this;S(i,{stack:y(e,function(e,n){var i=new H(n,t);this.result.push(i);r.push(i.dfd)},[]),dfd:new D});D.queue(r,function(e){!!n&&n.call(i.stack[e],e,i.stack[e].path);i.stack[e].run();return true}).always(function(){i.dfd.complete.apply(i.dfd,y(arguments,function(e,t){!t.success&&(this.result[0]=false);this.result[1].push(P.defined.get(t.path)||t)},[true,[]]))})}});S(e,E(t,[F,I,q,R,U]))})(this.window||this)